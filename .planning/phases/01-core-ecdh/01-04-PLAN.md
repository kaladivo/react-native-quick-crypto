---
phase: 01-core-ecdh
plan: 04
type: execute
wave: 4
depends_on: ["01-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can call createECDH('secp256k1') in React Native app"
    - "User can generate keys and see public key output"
    - "User can export keys in different formats (hex, base64)"
    - "User can import a private key and retrieve derived public key"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete ECDH implementation works end-to-end in the React Native example app.

Purpose: Confirms all Phase 1 requirements are met before moving to Phase 2 (secret derivation).
Output: Verified working ECDH implementation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-core-ecdh/01-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete ECDH implementation for React Native Quick Crypto:
- Native C++ module with secp256k1 key operations (HybridEcdh)
- TypeScript ECDH class with Node.js-compatible API
- createECDH('secp256k1') factory function
- Key generation, import, and export functionality
  </what-built>
  <how-to-verify>
1. Build and run the example app (Android or iOS):
   ```bash
   cd example
   bun ios    # or bun android
   ```

2. In the app (or via test/console), verify these operations:
   ```javascript
   import { createECDH } from 'react-native-quick-crypto';

   // Test 1: Create ECDH instance
   const ecdh = createECDH('secp256k1');
   console.log('ECDH instance created');

   // Test 2: Generate keys
   const publicKey = ecdh.generateKeys();
   console.log('Public key (Buffer):', publicKey.length, 'bytes');  // Should be 65

   // Test 3: Get public key in different formats
   const pubHex = ecdh.getPublicKey('hex');
   const pubHexCompressed = ecdh.getPublicKey('hex', 'compressed');
   console.log('Public key hex (uncompressed):', pubHex.length, 'chars');  // Should be 130
   console.log('Public key hex (compressed):', pubHexCompressed.length, 'chars');  // Should be 66

   // Test 4: Get private key
   const privKey = ecdh.getPrivateKey();
   const privHex = ecdh.getPrivateKey('hex');
   console.log('Private key (Buffer):', privKey.length, 'bytes');  // Should be 32
   console.log('Private key hex:', privHex.length, 'chars');  // Should be 64

   // Test 5: Import private key and verify public key derivation
   const ecdh2 = createECDH('secp256k1');
   ecdh2.setPrivateKey(privKey);
   const derivedPubKey = ecdh2.getPublicKey('hex');
   console.log('Derived public key matches:', derivedPubKey === pubHex);  // Should be true

   // Test 6: Invalid curve throws
   try {
     createECDH('invalid-curve');
   } catch (e) {
     console.log('Invalid curve error:', e.code);  // Should be ERR_CRYPTO_INVALID_CURVE
   }
   ```

3. Expected results:
   - All console.log statements execute without errors
   - Public key Buffer is 65 bytes (uncompressed)
   - Public key hex is 130 chars (65 bytes * 2)
   - Compressed public key hex is 66 chars (33 bytes * 2)
   - Private key is 32 bytes / 64 hex chars
   - Derived public key matches original public key
   - Invalid curve throws with ERR_CRYPTO_INVALID_CURVE code
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass, or describe any failures with:
- Which test failed
- Expected vs actual output
- Any error messages
  </resume-signal>
</task>

</tasks>

<verification>
- [ ] App builds successfully (Android or iOS)
- [ ] createECDH('secp256k1') returns ECDH instance
- [ ] generateKeys() produces 65-byte public key (uncompressed)
- [ ] Compressed format produces 33-byte key
- [ ] Private key is 32 bytes
- [ ] setPrivateKey + getPublicKey returns same public key as original
- [ ] Invalid curve throws with proper error code
</verification>

<success_criteria>
Phase 1 requirements verified:
- ECDH-01: createECDH('secp256k1') works
- ECDH-02, ECDH-03, ECDH-04: generateKeys with encoding/format works
- ECDH-10 through ECDH-15: getPublicKey/getPrivateKey work
- ECDH-16, ECDH-17, ECDH-18: setPrivateKey with auto-derivation works

Ready for Phase 2 (computeSecret and security validation).
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-ecdh/01-04-SUMMARY.md`
</output>
