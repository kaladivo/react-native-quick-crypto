---
phase: 01.1-fix-expo-build
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/react-native-quick-crypto/QuickCrypto.podspec
autonomous: true

must_haves:
  truths:
    - "QuickCrypto.podspec includes NitroModules header search path"
    - "iOS build can find NitroModules headers"
  artifacts:
    - path: "packages/react-native-quick-crypto/QuickCrypto.podspec"
      provides: "Header search path for NitroModules"
      contains: "Headers/Private"
  key_links:
    - from: "QuickCrypto.podspec"
      to: "Pods/Headers/Private/NitroModules"
      via: "HEADER_SEARCH_PATHS xcconfig"
      pattern: 'PODS_ROOT.*Headers.*NitroModules'
---

<objective>
Fix iOS build by adding NitroModules header search path to QuickCrypto.podspec.

Purpose: The iOS build fails with "#error NitroModules cannot be found!" because the QuickCrypto pod's xcconfig doesn't include the NitroModules header directory in its search paths. The Nitrogen-generated headers use `#if __has_include(<NitroModules/JSIConverter.hpp>)` which requires framework-style header search paths.

Output: Modified QuickCrypto.podspec with NitroModules header path in pod_target_xcconfig.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01.1-fix-expo-build/01.1-RESEARCH.md
@packages/react-native-quick-crypto/QuickCrypto.podspec
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add NitroModules header search path to podspec</name>
  <files>packages/react-native-quick-crypto/QuickCrypto.podspec</files>
  <action>
Modify QuickCrypto.podspec to include NitroModules header paths in the HEADER_SEARCH_PATHS.

The Nitrogen-generated files use `#if __has_include(<NitroModules/JSIConverter.hpp>)` syntax which requires framework-style header lookup. The headers exist at:
- `${PODS_ROOT}/Headers/Private/NitroModules/` (57 files)
- `${PODS_ROOT}/Headers/Public/NitroModules/` (24 files)

For the `<NitroModules/...>` include style to work, we need the PARENT directory in the search path (so NitroModules becomes a subdirectory).

In the cpp_headers array (around line 130-136), add these paths:
```ruby
"\"${PODS_ROOT}/Headers/Private\"",
"\"${PODS_ROOT}/Headers/Public\""
```

These should be added at the END of the cpp_headers array before the closing bracket.

Current cpp_headers:
```ruby
cpp_headers = [
  "\"$(PODS_TARGET_SRCROOT)/cpp/utils\"",
  "\"$(PODS_TARGET_SRCROOT)/cpp/hkdf\"",
  "\"$(PODS_TARGET_SRCROOT)/deps/ncrypto/include\"",
  "\"$(PODS_TARGET_SRCROOT)/deps/blake3/c\"",
  "\"$(PODS_TARGET_SRCROOT)/deps/fastpbkdf2\""
]
```

After modification:
```ruby
cpp_headers = [
  "\"$(PODS_TARGET_SRCROOT)/cpp/utils\"",
  "\"$(PODS_TARGET_SRCROOT)/cpp/hkdf\"",
  "\"$(PODS_TARGET_SRCROOT)/deps/ncrypto/include\"",
  "\"$(PODS_TARGET_SRCROOT)/deps/blake3/c\"",
  "\"$(PODS_TARGET_SRCROOT)/deps/fastpbkdf2\"",
  "\"${PODS_ROOT}/Headers/Private\"",
  "\"${PODS_ROOT}/Headers/Public\""
]
```

Note: Use ${PODS_ROOT} (not PODS_TARGET_SRCROOT) for the Headers directories - these are CocoaPods standard paths, not package-relative paths.
  </action>
  <verify>
Read QuickCrypto.podspec and confirm:
1. `"${PODS_ROOT}/Headers/Private"` appears in cpp_headers array
2. `"${PODS_ROOT}/Headers/Public"` appears in cpp_headers array
3. Ruby syntax is valid (no missing commas, proper quoting)
  </verify>
  <done>QuickCrypto.podspec contains NitroModules header paths in HEADER_SEARCH_PATHS</done>
</task>

<task type="auto">
  <name>Task 2: Clean iOS pods to ensure fresh install picks up changes</name>
  <files>example/ios/Podfile.lock</files>
  <action>
After modifying the podspec, the iOS build should be tested with fresh pods.

Instruct user (in SUMMARY) that they need to run:
```bash
cd example/ios
rm -rf Pods Podfile.lock
pod install
```

This ensures CocoaPods regenerates the xcconfig files with the new header search paths.

Note: Do NOT run this command as part of this plan - just document it in the SUMMARY as a required follow-up step. The actual verification will happen in Plan 01.1-03.
  </action>
  <verify>
Verify the podspec modification is syntactically correct:
```bash
cd packages/react-native-quick-crypto
ruby -c QuickCrypto.podspec
```
Should output "Syntax OK".
  </verify>
  <done>Podspec is syntactically valid Ruby, ready for pod install</done>
</task>

</tasks>

<verification>
1. QuickCrypto.podspec contains Headers/Private and Headers/Public in cpp_headers
2. Ruby syntax check passes (ruby -c QuickCrypto.podspec)
3. No other podspec changes that could break existing functionality
</verification>

<success_criteria>
- HEADER_SEARCH_PATHS includes NitroModules directories
- Podspec syntax is valid
- After pod install, `#if __has_include(<NitroModules/JSIConverter.hpp>)` will resolve
</success_criteria>

<output>
After completion, create `.planning/phases/01.1-fix-expo-build/01.1-02-SUMMARY.md`
</output>
